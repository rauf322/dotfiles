# Personal Tmux Configuration
# Clean, minimal tmux setup with tmux-minimal-theme

# -- Prefix and Basic Settings ----------------------------------------------------
set -g prefix C-a
unbind C-b
bind-key C-a send-prefix

# -- Core Settings ---------------------------------------------------------------
set-option -g mouse on
set -g base-index 1                    # start windows numbering at 1
setw -g pane-base-index 1              # make pane numbering consistent with windows
setw -g automatic-rename on            # rename window to reflect current program
set -g renumber-windows on             # renumber windows when a window is closed
set -g set-titles on                   # set terminal title
set -g display-panes-time 800          # slightly longer pane indicators display time
set -g display-time 1000               # slightly longer status messages display time
set -g status-interval 10              # redraw status line every 10 seconds
set -g history-limit 5000              # boost history
set -g detach-on-destroy off           # don't exit from tmux when closing a session
set -g set-clipboard on                # use system clipboard
set -g status-position bottom          # status bar at bottom
set -g allow-passthrough on
set -ga update-environment TERM
set -ga update-environment TERM_PROGRAM

# -- Terminal and Color Support --------------------------------------------------
set -g default-terminal "tmux-256color"
set-option -sa terminal-features ',xterm-256color:RGB'

# -- Transparency Support --------------------------------------------------------
set-option -sa terminal-overrides ',*:Tc'  # true color support
set -g window-style 'bg=default'           # transparent window background
set -g window-active-style 'bg=default'    # transparent active window background

# UTF-8 support
set -q -g status-utf8 on
setw -q -g utf8 on

# -- Keybindings ------------------------------------------------------------------

# Session management
bind-key K kill-session               # Kill session
bind C-c new-session                  # Create new session
bind c new-window                     # Create new window

# Pane navigation (vim-like)
bind h select-pane -L              # move left
bind j select-pane -D              # move down
bind k select-pane -U              # move up
bind l select-pane -R              # move right

# Smart pane switching with awareness of Vim splits (tmux-vim-navigator)
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|l?n?vim?x?|fzf)(diff)?$'"
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'

# Fallback for tmux < 2.1
bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R

# Pane splitting
unbind %
bind | split-window -h                # Split horizontally
unbind '"'
bind - split-window -v                # Split vertically

# Pane resizing
bind -r , resize-pane -L 15     # Resize left (comma)
bind -r . resize-pane -R 15     # Resize right (period)
bind -r < resize-pane -U 15     # Resize up
bind -r > resize-pane -D 15    # Resize down

# Pane switcher from left to right
bind -r H swap-pane -U
bind -r L swap-pane -D

# Window management
bind -r R command-prompt "rename-window %%"  # Rename window
bind -r x kill-pane                      # Kill pane
bind -r f resize-pane -Z                 # Toggle pane zoom

# Config management
bind -r r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded!"

# Toggle opencode
bind -r p run-shell "tmux-open-opencode"

# Cursor (reuse window) — Prefix + u
bind-key -r u run-shell "tmux-open-cursor"

# VS Code (reuse window) — Prefix + v
bind-key -r v run-shell "tmux-open-vscode"

# Neovim in current pane — Prefix + n
bind-key -r n run-shell "tmux-open-nvim"


# Session switcher (enhanced tmux-sessionizer with -s commands)
bind-key Tab run-shell "tmux neww tmux-sessionizer"
bind-key -r M-h run-shell "tmux neww tmux-sessionizer -s 0"
bind-key -r M-t run-shell "tmux neww tmux-sessionizer -s 1"

# Open command history with fzf
bind -r ` display-popup 'fish -c "$(fish -c history | fzf)"'

# Lazygit popup
bind -r t switch-client -T lazygit-table
bind -r -T lazygit-table g display-popup -d '#{pane_current_path}' -w 90% -h 90% -E 'lazygit'

# -- Copy Mode (Vi-style) ---------------------------------------------------------
setw -g mode-keys vi

# Copy mode bindings
bind V copy-mode -u                   # Enter copy mode
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi Escape send -X cancel
bind -T copy-mode-vi c if -F '#{selection_present}' 'send -X clear-selection' 'send -X begin-selection'
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "xclip -selection clipboard -in"

# Copy mode navigation
bind -T copy-mode-vi h send -N1 -X cursor-left
bind -T copy-mode-vi l send -N1 -X cursor-right
bind -T copy-mode-vi j send -N1 -X cursor-down
bind -T copy-mode-vi k send -N1 -X cursor-up

# Mouse wheel scrolling
bind -Tcopy-mode WheelUpPane send -N1 -X scroll-up
bind -Tcopy-mode WheelDownPane send -N1 -X scroll-down

# -- Minimal Theme Configuration --------------------------------------------------
# tmux-minimal-theme color scheme (Catppuccin Mocha) - with transparency
set -g @minimal_theme_bg_color "default"
set -g @minimal_theme_active_color "#b4befe"
set -g @minimal_theme_inactive_color "#6c7086"
set -g @minimal_theme_text_color "#cdd6f4"
set -g @minimal_theme_accent_color "#b4befe"
set -g @minimal_theme_border_color "#44475a"

# Alternative color schemes (uncomment to use):

# Tokyo Night
# set -g @minimal_theme_bg_color "#1a1b26"
# set -g @minimal_theme_active_color "#7aa2f7"
# set -g @minimal_theme_inactive_color "#565f89"
# set -g @minimal_theme_text_color "#c0caf5"
# set -g @minimal_theme_accent_color "#7aa2f7"
# set -g @minimal_theme_border_color "#414868"

# Dracula
# set -g @minimal_theme_bg_color "#282a36"
# set -g @minimal_theme_active_color "#bd93f9"
# set -g @minimal_theme_inactive_color "#6272a4"
# set -g @minimal_theme_text_color "#f8f8f2"
# set -g @minimal_theme_accent_color "#bd93f9"
# set -g @minimal_theme_border_color "#44475a"

# Gruvbox Dark
# set -g @minimal_theme_bg_color "#1d2021"
# set -g @minimal_theme_active_color "#83a598"
# set -g @minimal_theme_inactive_color "#665c54"
# set -g @minimal_theme_text_color "#ebdbb2"
# set -g @minimal_theme_accent_color "#83a598"
# set -g @minimal_theme_border_color "#504945"

# -- Initialize Custom Minimal Theme ---------------------------------------------
# Load and apply our custom minimal theme with macOS support and proper emojis
run-shell 'source ~/.config/tmux/scripts/custom-minimal-theme.sh && apply_custom_minimal_theme'

# -- Plugin Management (TPM) -----------------------------------------------------
# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'omerxx/tmux-sessionx'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @resurrect-capture-pane-contents "on"

# -- SessionX True Telescope Layout (Search → List | Preview) ---------------
set -g @sessionx-zoxide-mode 'on'
set -g @sessionx-bind 'w'                     # Bind to prefix + w
set -g @sessionx-window-height '85%'          # Full height like telescope
set -g @sessionx-window-width '85%'           # Full width like telescope
set -g @sessionx-layout 'reverse'             # Default layout - search at top
set -g @sessionx-preview-location 'right'     # Preview on right side
set -g @sessionx-prompt " "
set -g @sessionx-preview-ratio '50%'          # Half screen for preview
set -g @sessionx-prompt ' '                  # Clean minimal prompt
set -g @sessionx-pointer '▶'                  # Simple pointer

# High contrast colors for better visibility
set -g @sessionx-additional-options "\
--color=bg+:#181825,bg:#11111b \
--color=border:#cba6f7,header:#89b4fa \
--color=gutter:#11111b,hl:#f38ba8 \
--color=hl+:#f5c2e7,info:#89dceb \
--color=marker:#a6e3a1,pointer:#fab387 \
--color=prompt:#89b4fa,spinner:#a6e3a1 \
--color=fg:#cdd6f4,fg+:#ffffff \
--border=sharp \
--info=inline \
--no-scrollbar \
--cycle"

run '~/.config/tmux/plugins/tpm/tpm'

